# AIèŠå¤©åº”ç”¨é¡¹ç›®æµç¨‹å›¾æ–‡æ¡£

## é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºReactçš„AIèŠå¤©åº”ç”¨ï¼ŒåŒ…å«ä¸¤ä¸ªä¸»è¦æœåŠ¡ï¼š
- **é™ªä¼´å¤§å¸ˆ** (HappyApp) - æ™ºèƒ½å¯¹è¯é™ªä¼´æœåŠ¡ï¼Œä½¿ç”¨å•æ¶ˆæ¯ç´¯ç§¯æ¨¡å¼
- **è¶…çº§æ™ºèƒ½ä½“** (Manus) - é«˜çº§æ™ºèƒ½åŠ©æ‰‹æœåŠ¡ï¼Œä½¿ç”¨æ­¥éª¤å¼å¤„ç†æ¨¡å¼

åº”ç”¨ä½¿ç”¨Server-Sent Events (SSE) æŠ€æœ¯å®ç°å®æ—¶æµå¼å¯¹è¯ï¼Œæ”¯æŒé”™è¯¯å¤„ç†ã€é‡è¿æœºåˆ¶å’Œå¤šç§æ¶ˆæ¯æ˜¾ç¤ºæ¨¡å¼ã€‚

---

## 1. æ•´ä½“åº”ç”¨æ¶æ„æµç¨‹å›¾

```mermaid
flowchart TD
    A[åº”ç”¨å¯åŠ¨ - index.js] --> B{æ£€æŸ¥ç™»å½•çŠ¶æ€}
    B -->|æœªç™»å½•| C[LoginPageç»„ä»¶]
    B -->|å·²ç™»å½•| D[æ˜¾ç¤ºHeader + å½“å‰é¡µé¢]
    
    C --> E[ç”¨æˆ·è¾“å…¥å‡­æ®]
    E --> F{éªŒè¯admin/admin}
    F -->|å¤±è´¥| G[æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯]
    G --> E
    F -->|æˆåŠŸ| H[è®¾ç½®loggedIn=true]
    H --> D
    
    D --> I[Headerå¯¼èˆªæ ]
    D --> J[é¡µé¢å†…å®¹åŒºåŸŸ]
    
    I --> K[é¦–é¡µæŒ‰é’®]
    I --> L[é™ªä¼´å¤§å¸ˆæŒ‰é’®] 
    I --> M[è¶…çº§æ™ºèƒ½ä½“æŒ‰é’®]
    I --> N[ç”¨æˆ·å¤´åƒ]
    
    N --> O[æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯å¼¹çª—]
    O --> P[é€€å‡ºç™»å½•]
    P --> Q[é‡ç½®çŠ¶æ€å›åˆ°ç™»å½•é¡µ]
    
    K --> R[HomePage - Navigationç»„ä»¶]
    L --> S[HappyAppPage]
    M --> T[ManusPage]
    
    R --> U[æœåŠ¡é€‰æ‹©ç•Œé¢]
    U --> V[ğŸ¤– AI é™ªä¼´å¤§å¸ˆå¡ç‰‡]
    U --> W[ğŸ§  AI è¶…çº§æ™ºèƒ½ä½“å¡ç‰‡]
    
    V --> S
    W --> T
    
    S --> X[ChatInterface - HappyAppæ¨¡å¼]
    T --> Y[ChatInterface - Manusæ¨¡å¼]
    
    X --> Z[å•æ¶ˆæ¯ç´¯ç§¯æ˜¾ç¤º]
    Y --> AA[æ­¥éª¤å¼åˆ†è§£æ˜¾ç¤º]
    
    Z --> BB[SSEé€šä¿¡å¤„ç†]
    AA --> BB
    
    BB --> CC[å®æ—¶æµå¼å“åº”]
    CC --> DD[æ¶ˆæ¯å®Œæˆå¤„ç†]
    DD --> EE[ç­‰å¾…ä¸‹ä¸€è½®å¯¹è¯]
    
    style C fill:#ffcdd2
    style S fill:#e3f2fd
    style T fill:#e8f5e8
    style BB fill:#fff3e0
```

---

## 2. ç”¨æˆ·è®¤è¯ä¸ä¼šè¯ç®¡ç†æµç¨‹

```mermaid
sequenceDiagram
    participant Browser as æµè§ˆå™¨
    participant App as Appç»„ä»¶
    participant LP as LoginPage
    participant Header as Headerç»„ä»¶
    participant LS as æœ¬åœ°çŠ¶æ€ç®¡ç†
    
    Browser->>App: è®¿é—®åº”ç”¨
    App->>LS: æ£€æŸ¥loggedInçŠ¶æ€
    LS->>App: è¿”å›false
    App->>LP: æ¸²æŸ“LoginPage
    
    LP->>Browser: æ˜¾ç¤ºç™»å½•è¡¨å•
    Browser->>LP: ç”¨æˆ·è¾“å…¥ç”¨æˆ·å/å¯†ç 
    LP->>LP: å®¢æˆ·ç«¯éªŒè¯é€»è¾‘
    
    alt éªŒè¯æˆåŠŸ (admin/admin)
        LP->>App: è°ƒç”¨onLoginå›è°ƒ
        App->>LS: è®¾ç½®loggedIn=true
        App->>Header: æ¸²æŸ“Headerç»„ä»¶
        App->>Browser: æ˜¾ç¤ºä¸»åº”ç”¨ç•Œé¢
        Note over Browser,LS: ç”¨æˆ·ç°åœ¨å¯ä»¥è®¿é—®æ‰€æœ‰åŠŸèƒ½
    else éªŒè¯å¤±è´¥
        LP->>LP: è®¾ç½®errorçŠ¶æ€
        LP->>Browser: æ˜¾ç¤ºé”™è¯¯æç¤º
        Note over Browser,LP: ç”¨æˆ·éœ€è¦é‡æ–°è¾“å…¥æ­£ç¡®å‡­æ®
    end
    
    Browser->>Header: ç‚¹å‡»ç”¨æˆ·å¤´åƒ
    Header->>App: è§¦å‘onUserIconClick
    App->>LS: è®¾ç½®showProfile=true
    App->>Browser: æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯å¼¹çª—
    
    Browser->>App: ç‚¹å‡»Log OutæŒ‰é’®
    App->>LS: è®¾ç½®loggedIn=false, showProfile=false
    App->>LP: é‡æ–°æ¸²æŸ“LoginPage
    App->>Browser: è¿”å›ç™»å½•ç•Œé¢
```

---

## 3. SSEèŠå¤©é€šä¿¡è¯¦ç»†æµç¨‹

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·ç•Œé¢
    participant CI as ChatInterface
    participant Helper as å·¥å…·å‡½æ•°
    participant API as createSSEConnection
    participant Server as åç«¯æœåŠ¡å™¨
    participant ES as EventSource
    
    User->>CI: è¾“å…¥æ¶ˆæ¯å¹¶ç‚¹å‡»å‘é€
    CI->>Helper: validateMessage(inputMessage)
    Helper->>CI: è¿”å›éªŒè¯ç»“æœ
    
    alt éªŒè¯å¤±è´¥
        CI->>User: æ˜¾ç¤ºé”™è¯¯æç¤º(ç©ºæ¶ˆæ¯/è¶…é•¿ç­‰)
    else éªŒè¯æˆåŠŸ
        CI->>Helper: generateChatId()
        Helper->>CI: è¿”å›å”¯ä¸€æ¶ˆæ¯ID
        CI->>CI: åˆ›å»ºç”¨æˆ·æ¶ˆæ¯å¯¹è±¡
        CI->>CI: åˆ›å»ºç©ºAIæ¶ˆæ¯å ä½ç¬¦
        CI->>User: ç«‹å³æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
        
        CI->>API: createSSEConnection(endpoint, params)
        API->>ES: new EventSource(url)
        ES->>Server: å»ºç«‹SSEè¿æ¥
        
        Server->>ES: onopenäº‹ä»¶
        ES->>CI: è¿æ¥çŠ¶æ€: CONNECTED
        CI->>User: æ›´æ–°è¿æ¥çŠ¶æ€æŒ‡ç¤ºå™¨
        
        loop æµå¼æ•°æ®æ¥æ”¶
            Server->>ES: å‘é€æ¶ˆæ¯ç‰‡æ®µ
            ES->>CI: onmessage(event)
            CI->>Helper: parseSSEData(event.data)
            Helper->>CI: è§£æåçš„å†…å®¹
            
            alt HappyAppæ¨¡å¼
                CI->>CI: ç´¯ç§¯æ¶ˆæ¯å†…å®¹
                CI->>User: å®æ—¶æ›´æ–°å•ä¸ªæ¶ˆæ¯æ¡†
                Note over CI,User: æ”¯æŒæ‰“å­—æœºæ•ˆæœ
            else Manusæ¨¡å¼
                CI->>CI: æ£€æµ‹æ­¥éª¤ç±»å‹
                alt æœç´¢æ­¥éª¤
                    CI->>CI: è§£æJSONæœç´¢ç»“æœ
                    CI->>User: æ˜¾ç¤º"æ­¥éª¤Xï¼šæœç´¢ç›¸å…³ä¿¡æ¯"
                else æ€è€ƒæ­¥éª¤
                    CI->>CI: æå–æ€è€ƒå†…å®¹
                    CI->>User: æ˜¾ç¤º"æ­¥éª¤Xï¼šåˆ†ææ€è€ƒ"
                else ä»»åŠ¡å®Œæˆæ­¥éª¤
                    CI->>User: æ˜¾ç¤º"æ­¥éª¤Xï¼šä»»åŠ¡å®Œæˆ"
                end
            end
        end
        
        Server->>ES: å‘é€[DONE]ä¿¡å·
        ES->>CI: æ£€æµ‹åˆ°å®Œæˆä¿¡å·
        CI->>ES: å…³é—­EventSourceè¿æ¥
        CI->>Helper: formatTimestamp()
        Helper->>CI: å½“å‰æ—¶é—´æˆ³
        CI->>CI: ä¸ºæ¶ˆæ¯æ·»åŠ æ—¶é—´æˆ³
        CI->>User: æ˜¾ç¤ºå®Œæ•´çš„å¸¦æ—¶é—´æˆ³æ¶ˆæ¯
        
        alt è¿æ¥é”™è¯¯å¤„ç†
            ES->>CI: onerroräº‹ä»¶
            CI->>ES: å…³é—­è¿æ¥
            CI->>CI: è®¾ç½®è¿æ¥çŠ¶æ€ä¸ºERROR
            CI->>User: æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯å’Œé‡è¯•æç¤º
        end
    end
```

---

## 4. ç»„ä»¶å±‚æ¬¡ç»“æ„ä¸æ•°æ®æµ

```mermaid
graph TD
    A[App.js - æ ¹ç»„ä»¶] --> B[çŠ¶æ€ç®¡ç†]
    A --> C[è·¯ç”±æ§åˆ¶]
    A --> D[å­ç»„ä»¶æ¸²æŸ“]
    
    B --> B1[currentPage - å½“å‰é¡µé¢]
    B --> B2[loggedIn - ç™»å½•çŠ¶æ€]
    B --> B3[showProfile - æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯]
    B --> B4[userInfo - ç”¨æˆ·ä¿¡æ¯å¯¹è±¡]
    
    C --> C1{è·¯ç”±åˆ¤æ–­é€»è¾‘}
    C1 -->|æœªç™»å½•| C2[LoginPage]
    C1 -->|home| C3[HomePage]
    C1 -->|happy-app| C4[HappyAppPage]
    C1 -->|manus| C5[ManusPage]
    
    D --> D1[Headerç»„ä»¶]
    D --> D2[é¡µé¢åç§°æ˜¾ç¤º]
    D --> D3[ç”¨æˆ·ä¿¡æ¯å¼¹çª—]
    
    C2 --> E1[ç™»å½•è¡¨å•]
    C3 --> E2[Navigationç»„ä»¶]
    C4 --> E3[ChatInterface - HappyAppé…ç½®]
    C5 --> E4[ChatInterface - Manusé…ç½®]
    
    E2 --> F1[æœåŠ¡é€‰æ‹©å¡ç‰‡]
    E3 --> F2[èŠå¤©ç•Œé¢ - å•æ¶ˆæ¯æ¨¡å¼]
    E4 --> F3[èŠå¤©ç•Œé¢ - æ­¥éª¤æ¨¡å¼]
    
    F2 --> G[ChatInterfaceæ ¸å¿ƒ]
    F3 --> G
    
    G --> G1[æ¶ˆæ¯çŠ¶æ€ç®¡ç†]
    G --> G2[SSEè¿æ¥ç®¡ç†]
    G --> G3[UIæ¸²æŸ“æ§åˆ¶]
    
    G1 --> H1[messagesæ•°ç»„]
    G1 --> H2[inputMessage]
    G1 --> H3[isLoading]
    G1 --> H4[chatId]
    
    G2 --> I1[EventSourceç®¡ç†]
    G2 --> I2[è¿æ¥çŠ¶æ€è·Ÿè¸ª]
    G2 --> I3[é”™è¯¯å¤„ç†]
    
    G3 --> J1[ChatMessageç»„ä»¶]
    G3 --> J2[LoadingAnimationç»„ä»¶]
    G3 --> J3[è¾“å…¥æ¡†å’Œå‘é€æŒ‰é’®]
    
    J1 --> K1[æ¶ˆæ¯å†…å®¹æ˜¾ç¤º]
    J1 --> K2[æ—¶é—´æˆ³æ˜¾ç¤º]
    J1 --> K3[æ‰“å­—æœºæ•ˆæœ]
    
    style A fill:#e1f5fe,stroke:#01579b,stroke-width:3px
    style G fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    style G1 fill:#fff3e0,stroke:#e65100,stroke-width:2px
    style G2 fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    style G3 fill:#fce4ec,stroke:#880e4f,stroke-width:2px
```

---

## 5. çŠ¶æ€ç®¡ç†ç”Ÿå‘½å‘¨æœŸ

```mermaid
stateDiagram-v2
    [*] --> åº”ç”¨åˆå§‹åŒ–
    åº”ç”¨åˆå§‹åŒ– --> æœªç™»å½•çŠ¶æ€
    
    state æœªç™»å½•çŠ¶æ€ {
        [*] --> æ˜¾ç¤ºç™»å½•é¡µé¢
        æ˜¾ç¤ºç™»å½•é¡µé¢ --> ç­‰å¾…ç”¨æˆ·è¾“å…¥
        ç­‰å¾…ç”¨æˆ·è¾“å…¥ --> éªŒè¯å‡­æ®
        éªŒè¯å‡­æ® --> éªŒè¯å¤±è´¥ : é”™è¯¯å‡­æ®
        éªŒè¯å‡­æ® --> ç™»å½•æˆåŠŸ : admin/admin
        éªŒè¯å¤±è´¥ --> æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ --> ç­‰å¾…ç”¨æˆ·è¾“å…¥
    }
    
    æœªç™»å½•çŠ¶æ€ --> å·²ç™»å½•çŠ¶æ€ : ç™»å½•æˆåŠŸ
    
    state å·²ç™»å½•çŠ¶æ€ {
        [*] --> é¦–é¡µçŠ¶æ€
        
        state é¦–é¡µçŠ¶æ€ {
            [*] --> æ˜¾ç¤ºæœåŠ¡é€‰æ‹©
            æ˜¾ç¤ºæœåŠ¡é€‰æ‹© --> ç­‰å¾…æœåŠ¡é€‰æ‹©
        }
        
        é¦–é¡µçŠ¶æ€ --> é™ªä¼´å¤§å¸ˆé¡µé¢ : é€‰æ‹©é™ªä¼´å¤§å¸ˆ
        é¦–é¡µçŠ¶æ€ --> è¶…çº§æ™ºèƒ½ä½“é¡µé¢ : é€‰æ‹©è¶…çº§æ™ºèƒ½ä½“
        
        state é™ªä¼´å¤§å¸ˆé¡µé¢ {
            [*] --> èŠå¤©ç©ºé—²HappyApp
            èŠå¤©ç©ºé—²HappyApp --> æ¶ˆæ¯å‘é€ä¸­HappyApp : ç”¨æˆ·å‘é€æ¶ˆæ¯
            æ¶ˆæ¯å‘é€ä¸­HappyApp --> SSEè¿æ¥ä¸­HappyApp : å»ºç«‹è¿æ¥
            SSEè¿æ¥ä¸­HappyApp --> æ¥æ”¶å“åº”HappyApp : å¼€å§‹æ¥æ”¶
            æ¥æ”¶å“åº”HappyApp --> å•æ¶ˆæ¯ç´¯ç§¯ : ç´¯ç§¯å†…å®¹
            å•æ¶ˆæ¯ç´¯ç§¯ --> æ¥æ”¶å“åº”HappyApp : ç»§ç»­æ¥æ”¶
            æ¥æ”¶å“åº”HappyApp --> æ¶ˆæ¯å®ŒæˆHappyApp : æ”¶åˆ°DONE
            æ¶ˆæ¯å®ŒæˆHappyApp --> èŠå¤©ç©ºé—²HappyApp : å‡†å¤‡ä¸‹ä¸€è½®
        }
        
        state è¶…çº§æ™ºèƒ½ä½“é¡µé¢ {
            [*] --> èŠå¤©ç©ºé—²Manus
            èŠå¤©ç©ºé—²Manus --> æ¶ˆæ¯å‘é€ä¸­Manus : ç”¨æˆ·å‘é€æ¶ˆæ¯
            æ¶ˆæ¯å‘é€ä¸­Manus --> SSEè¿æ¥ä¸­Manus : å»ºç«‹è¿æ¥
            SSEè¿æ¥ä¸­Manus --> æ¥æ”¶å“åº”Manus : å¼€å§‹æ¥æ”¶
            æ¥æ”¶å“åº”Manus --> æ­¥éª¤åˆ†æå¤„ç† : è§£ææ­¥éª¤
            
            state æ­¥éª¤åˆ†æå¤„ç† {
                [*] --> æ£€æµ‹æ­¥éª¤ç±»å‹
                æ£€æµ‹æ­¥éª¤ç±»å‹ --> æœç´¢æ­¥éª¤å¤„ç† : toolwebSearchTool
                æ£€æµ‹æ­¥éª¤ç±»å‹ --> æ€è€ƒæ­¥éª¤å¤„ç† : Thinking finish
                æ£€æµ‹æ­¥éª¤ç±»å‹ --> å®Œæˆæ­¥éª¤å¤„ç† : Task finished
                æ£€æµ‹æ­¥éª¤ç±»å‹ --> é€šç”¨æ­¥éª¤å¤„ç† : å…¶ä»–ç±»å‹
                
                æœç´¢æ­¥éª¤å¤„ç† --> åˆ›å»ºæ­¥éª¤æ¶ˆæ¯
                æ€è€ƒæ­¥éª¤å¤„ç† --> åˆ›å»ºæ­¥éª¤æ¶ˆæ¯
                å®Œæˆæ­¥éª¤å¤„ç† --> åˆ›å»ºæ­¥éª¤æ¶ˆæ¯
                é€šç”¨æ­¥éª¤å¤„ç† --> åˆ›å»ºæ­¥éª¤æ¶ˆæ¯
            }
            
            æ­¥éª¤åˆ†æå¤„ç† --> æ¥æ”¶å“åº”Manus : ç»§ç»­æ¥æ”¶
            æ¥æ”¶å“åº”Manus --> æ¶ˆæ¯å®ŒæˆManus : æ”¶åˆ°DONE
            æ¶ˆæ¯å®ŒæˆManus --> èŠå¤©ç©ºé—²Manus : å‡†å¤‡ä¸‹ä¸€è½®
        }
        
        é™ªä¼´å¤§å¸ˆé¡µé¢ --> é¦–é¡µçŠ¶æ€ : è¿”å›é¦–é¡µ
        è¶…çº§æ™ºèƒ½ä½“é¡µé¢ --> é¦–é¡µçŠ¶æ€ : è¿”å›é¦–é¡µ
        
        state ç”¨æˆ·ç®¡ç† {
            [*] --> å¤´åƒç‚¹å‡»
            å¤´åƒç‚¹å‡» --> æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
            æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯ --> ç‚¹å‡»é€€å‡ºç™»å½•
        }
        
        é¦–é¡µçŠ¶æ€ --> ç”¨æˆ·ç®¡ç† : ç‚¹å‡»ç”¨æˆ·å¤´åƒ
        é™ªä¼´å¤§å¸ˆé¡µé¢ --> ç”¨æˆ·ç®¡ç† : ç‚¹å‡»ç”¨æˆ·å¤´åƒ
        è¶…çº§æ™ºèƒ½ä½“é¡µé¢ --> ç”¨æˆ·ç®¡ç† : ç‚¹å‡»ç”¨æˆ·å¤´åƒ
    }
    
    å·²ç™»å½•çŠ¶æ€ --> æœªç™»å½•çŠ¶æ€ : é€€å‡ºç™»å½•
    æœªç™»å½•çŠ¶æ€ --> [*] : åº”ç”¨å…³é—­
```

---

## 6. é”™è¯¯å¤„ç†ä¸å¼‚å¸¸æµç¨‹

```mermaid
flowchart TD
    A[ç”¨æˆ·æ“ä½œ] --> B{æ“ä½œç±»å‹}
    
    B -->|ç™»å½•| C[ç™»å½•éªŒè¯]
    B -->|å‘é€æ¶ˆæ¯| D[æ¶ˆæ¯éªŒè¯]
    B -->|SSEè¿æ¥| E[ç½‘ç»œè¿æ¥]
    
    C --> F{éªŒè¯ç»“æœ}
    F -->|æˆåŠŸ| G[è¿›å…¥åº”ç”¨]
    F -->|å¤±è´¥| H[æ˜¾ç¤ºç™»å½•é”™è¯¯]
    H --> I[ç”¨æˆ·é‡æ–°è¾“å…¥]
    I --> C
    
    D --> J{æ¶ˆæ¯æœ‰æ•ˆæ€§}
    J -->|ç©ºæ¶ˆæ¯| K[æ˜¾ç¤ºæ¶ˆæ¯ä¸èƒ½ä¸ºç©º]
    J -->|è¶…é•¿æ¶ˆæ¯| L[æ˜¾ç¤ºæ¶ˆæ¯è¿‡é•¿]
    J -->|æœ‰æ•ˆæ¶ˆæ¯| M[ç»§ç»­å¤„ç†]
    K --> N[ä¿æŒè¾“å…¥ç„¦ç‚¹]
    L --> N
    N --> D
    
    E --> O{è¿æ¥çŠ¶æ€}
    O -->|è¿æ¥æˆåŠŸ| P[æ­£å¸¸é€šä¿¡]
    O -->|è¿æ¥å¤±è´¥| Q[SSEé”™è¯¯å¤„ç†]
    O -->|è¿æ¥è¶…æ—¶| R[è¶…æ—¶é”™è¯¯å¤„ç†]
    
    Q --> S[å…³é—­EventSource]
    R --> S
    S --> T[è®¾ç½®é”™è¯¯çŠ¶æ€]
    T --> U[æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯]
    U --> V{æ˜¯å¦æœ‰éƒ¨åˆ†æ•°æ®}
    V -->|æœ‰| W[ä¿ç•™éƒ¨åˆ†å›å¤å¹¶æ·»åŠ æ—¶é—´æˆ³]
    V -->|æ— | X[æ˜¾ç¤ºå®Œæ•´é”™è¯¯æ¶ˆæ¯]
    W --> Y[å‡†å¤‡é‡è¯•]
    X --> Y
    
    P --> Z[æ•°æ®è§£æ]
    Z --> AA{è§£æç»“æœ}
    AA -->|æˆåŠŸ| BB[æ­£å¸¸æ˜¾ç¤º]
    AA -->|å¤±è´¥| CC[JSONè§£æé”™è¯¯]
    CC --> DD[ä½¿ç”¨çº¯æ–‡æœ¬æ˜¾ç¤º]
    DD --> BB
    
    Y --> EE[ç­‰å¾…ç”¨æˆ·é‡è¯•]
    EE --> B
    
    style H fill:#ffcdd2
    style K fill:#ffcdd2
    style L fill:#ffcdd2
    style Q fill:#ffcdd2
    style R fill:#ffcdd2
    style CC fill:#ffe0b2
    style BB fill:#c8e6c9

```

---

## 7. æ•°æ®æµä¸APIäº¤äº’

```mermaid
flowchart TD
    A[ç”¨æˆ·è¾“å…¥æ•°æ®] --> B[å‰ç«¯æ•°æ®éªŒè¯å±‚]
    B --> C{éªŒè¯ç»“æœ}
    C -->|å¤±è´¥| D[é”™è¯¯æç¤ºåé¦ˆ]
    C -->|æˆåŠŸ| E[æ•°æ®é¢„å¤„ç†]
    
    E --> F[æ¶ˆæ¯å¯¹è±¡æ„å»º]
    F --> G[çŠ¶æ€ç®¡ç†æ›´æ–°]
    G --> H[UIå³æ—¶å“åº”]
    
    F --> I[SSEè¯·æ±‚æ„å»º]
    I --> J[APIå‚æ•°ç»„è£…]
    J --> K{æœåŠ¡ç±»å‹}
    K -->|HappyApp| L["API: /ai/happy_app/chat/sse2"]
    K -->|Manus| M["API: /ai/manus/chat"]
    
    L --> N[EventSourceè¿æ¥å»ºç«‹]
    M --> N
    N --> O[åç«¯APIæœåŠ¡å™¨]
    
    O --> P[AIæ¨¡å‹å¤„ç†]
    P --> Q[æµå¼å“åº”ç”Ÿæˆ]
    Q --> R[SSEæ•°æ®æµä¼ è¾“]
    
    R --> S[å‰ç«¯SSEäº‹ä»¶æ¥æ”¶]
    S --> T[æ•°æ®è§£æå¼•æ“]
    T --> U{å“åº”æ•°æ®æ ¼å¼}
    U -->|JSONæ ¼å¼| V[JSONè§£æå¤„ç†]
    U -->|çº¯æ–‡æœ¬| W[æ–‡æœ¬å†…å®¹å¤„ç†]
    U -->|å®Œæˆä¿¡å·| X[æµç»“æŸå¤„ç†]
    
    V --> Y{è§£æç»“æœ}
    Y -->|æˆåŠŸ| Z[å†…å®¹æå–]
    Y -->|å¤±è´¥| AA[é™çº§æ–‡æœ¬å¤„ç†]
    
    Z --> BB[æ¶ˆæ¯å†…å®¹ç´¯ç§¯]
    AA --> BB
    W --> BB
    
    BB --> CC{æ˜¾ç¤ºæ¨¡å¼}
    CC -->|HappyAppå•æ¶ˆæ¯| DD[å•æ¶ˆæ¯å®æ—¶æ›´æ–°]
    CC -->|Manusæ­¥éª¤å¼| EE[æ­¥éª¤æ¶ˆæ¯åˆ†è§£]
    
    EE --> FF[æ­¥éª¤ç±»å‹è¯†åˆ«]
    FF --> GG{æ­¥éª¤åˆ†ç±»}
    GG -->|æœç´¢æ­¥éª¤| HH[æœç´¢ç»“æœè§£æ]
    GG -->|æ€è€ƒæ­¥éª¤| II[æ€è€ƒå†…å®¹æå–]
    GG -->|å®Œæˆæ­¥éª¤| JJ[ä»»åŠ¡çŠ¶æ€æ˜¾ç¤º]
    GG -->|å…¶ä»–æ­¥éª¤| KK[é€šç”¨æ­¥éª¤å¤„ç†]
    
    HH --> LL[æœç´¢ä¿¡æ¯æ ¼å¼åŒ–]
    II --> MM[æ€è€ƒè¿‡ç¨‹å±•ç¤º]
    JJ --> NN[å®ŒæˆçŠ¶æ€æ ‡è¯†]
    KK --> OO[åŸºç¡€çŠ¶æ€æ˜¾ç¤º]
    
    DD --> PP[UIç»„ä»¶æ¸²æŸ“]
    LL --> PP
    MM --> PP
    NN --> PP
    OO --> PP
    
    X --> QQ[æ·»åŠ æ—¶é—´æˆ³]
    QQ --> RR[æ ‡è®°æ¶ˆæ¯å®Œæˆ]
    RR --> PP
    
    PP --> SS[ç”¨æˆ·ç•Œé¢æ›´æ–°]
    SS --> TT[æ»šåŠ¨åˆ°æœ€æ–°æ¶ˆæ¯]
    TT --> UU[ç­‰å¾…ä¸‹ä¸€è½®äº¤äº’]
    
    D --> VV[ä¿æŒè¾“å…¥ç„¦ç‚¹]
    VV --> WW[ç”¨æˆ·é‡æ–°è¾“å…¥]
    WW --> A
    
    UU --> XX[ç”¨æˆ·ç»§ç»­å¯¹è¯]
    XX --> A
    
    style O fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    style P fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    style T fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style PP fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    style D fill:#ffcdd2,stroke:#d32f2f,stroke-width:2px
```

---

## 8. é¡¹ç›®æ–‡ä»¶ç»“æ„ä¸æ¨¡å—ä¾èµ–

```mermaid
graph TD
    A[src/] --> B[index.js åº”ç”¨å…¥å£]
    A --> C[App.js æ ¹ç»„ä»¶]
    A --> D[pages/ é¡µé¢ç»„ä»¶]
    A --> E[components/ é€šç”¨ç»„ä»¶]
    A --> F[utils/ å·¥å…·æ¨¡å—]
    A --> G[styles/ æ ·å¼æ–‡ä»¶]
    
    B --> H[React.StrictMode]
    B --> I[ReactDOM.render]
    H --> C
    
    C --> J[çŠ¶æ€ç®¡ç† - useState Hook]
    C --> K[æ¡ä»¶æ¸²æŸ“é€»è¾‘]
    C --> L[å…¨å±€ç”¨æˆ·ä¿¡æ¯ç®¡ç†]
    
    D --> M[LoginPage.js]
    D --> N[HomePage.js] 
    D --> O[HappyAppPage.js]
    D --> P[ManusPage.js]
    
    E --> Q[Header.js é¡¶éƒ¨å¯¼èˆª]
    E --> R[Navigation.js æœåŠ¡é€‰æ‹©]
    E --> S[ChatInterface.js èŠå¤©æ ¸å¿ƒ]
    E --> T[ChatMessage.js æ¶ˆæ¯æ˜¾ç¤º]
    E --> U[LoadingAnimation.js åŠ è½½åŠ¨ç”»]
    
    F --> V[api.js APIé…ç½®]
    F --> W[helpers.js å·¥å…·å‡½æ•°]
    
    G --> X[globals.css å…¨å±€æ ·å¼]
    G --> Y[App.css ç»„ä»¶æ ·å¼]
    
    M --> Z[è¡¨å•éªŒè¯é€»è¾‘]
    M --> AA[é”™è¯¯çŠ¶æ€ç®¡ç†]
    
    N --> R
    O --> S
    P --> S
    
    Q --> BB[å¯¼èˆªçŠ¶æ€ç®¡ç†]
    Q --> CC[ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º]
    
    S --> DD[æ¶ˆæ¯çŠ¶æ€ç®¡ç†]
    S --> EE[SSEè¿æ¥ç®¡ç†]
    S --> FF[é”™è¯¯å¤„ç†æœºåˆ¶]
    S --> T
    S --> U
    
    T --> GG[æ¶ˆæ¯æ¸²æŸ“é€»è¾‘]
    T --> HH[æ—¶é—´æˆ³æ ¼å¼åŒ–]
    T --> II[æ‰“å­—æœºæ•ˆæœ]
    
    V --> JJ[SSEè¿æ¥åˆ›å»º]
    V --> KK[APIç«¯ç‚¹é…ç½®]
    V --> LL[è¿æ¥çŠ¶æ€å¸¸é‡]
    
    W --> MM[IDç”Ÿæˆå™¨]
    W --> NN[æ—¶é—´æ ¼å¼åŒ–]
    W --> OO[æ¶ˆæ¯éªŒè¯]
    W --> PP[SSEæ•°æ®è§£æ]
    W --> QQ[UIæ»šåŠ¨æ§åˆ¶]
    
    X --> RR[CSSå˜é‡å®šä¹‰]
    X --> SS[å“åº”å¼è®¾è®¡]
    X --> TT[åŠ¨ç”»æ•ˆæœ]
    X --> UU[ä¸»é¢˜æ ·å¼]
    
    style C fill:#e1f5fe,stroke:#01579b,stroke-width:3px
    style S fill:#f3e5f5,stroke:#4a148c,stroke-width:3px
    style V fill:#fff3e0,stroke:#e65100,stroke-width:2px
    style W fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    style X fill:#fce4ec,stroke:#880e4f,stroke-width:2px
```

---

## 9. æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ

```mermaid
mindmap
  root((æ€§èƒ½ä¼˜åŒ–ç­–ç•¥))
    ç»„ä»¶ä¼˜åŒ–
      React.memoä½¿ç”¨
        ChatMessageç»„ä»¶
        LoadingAnimationç»„ä»¶
      useCallbackä¼˜åŒ–
        äº‹ä»¶å¤„ç†å‡½æ•°
        çŠ¶æ€æ›´æ–°å‡½æ•°
      useMemoç¼“å­˜
        å¤æ‚è®¡ç®—ç»“æœ
        æ ¼å¼åŒ–æ•°æ®
    çŠ¶æ€ç®¡ç†ä¼˜åŒ–
      çŠ¶æ€ç»“æ„è®¾è®¡
        æ‰å¹³åŒ–çŠ¶æ€
        é¿å…æ·±å±‚åµŒå¥—
      æ‰¹é‡æ›´æ–°
        å¤šä¸ªçŠ¶æ€åˆå¹¶
        å‡å°‘é‡æ¸²æŸ“
      æ¡ä»¶æ¸²æŸ“
        æŒ‰éœ€æ¸²æŸ“ç»„ä»¶
        æ‡’åŠ è½½å®ç°
    ç½‘ç»œä¼˜åŒ–
      SSEè¿æ¥ç®¡ç†
        è¿æ¥å¤ç”¨
        è‡ªåŠ¨é‡è¿æœºåˆ¶
        é”™è¯¯æ¢å¤ç­–ç•¥
      æ•°æ®ä¼ è¾“
        æ¶ˆæ¯å‹ç¼©
        å¢é‡æ›´æ–°
        ç¼“å­˜ç­–ç•¥
    UI/UXä¼˜åŒ–
      å“åº”å¼è®¾è®¡
        ç§»åŠ¨ç«¯é€‚é…
        è§¦æ‘¸å‹å¥½
      åŠ è½½çŠ¶æ€
        éª¨æ¶å±
        è¿›åº¦æŒ‡ç¤ºå™¨
      é”™è¯¯å¤„ç†
        å‹å¥½é”™è¯¯æç¤º
        é‡è¯•æœºåˆ¶
    ä»£ç ä¼˜åŒ–
      æ¨¡å—åŒ–è®¾è®¡
        åŠŸèƒ½åˆ†ç¦»
        å¯å¤ç”¨ç»„ä»¶
      å·¥å…·å‡½æ•°
        çº¯å‡½æ•°è®¾è®¡
        å•ä¸€èŒè´£
      ç±»å‹å®‰å…¨
        PropTypeséªŒè¯
        TypeScriptè¿ç§»
```

---

## 10. éƒ¨ç½²ä¸è¿ç»´æµç¨‹

```mermaid
gitgraph
    commit id: "é¡¹ç›®åˆå§‹åŒ–"
    branch development
    checkout development
    commit id: "ç™»å½•åŠŸèƒ½å¼€å‘"
    commit id: "èŠå¤©ç•Œé¢å¼€å‘"
    commit id: "SSEé›†æˆ"
    
    branch feature/happy-app
    checkout feature/happy-app
    commit id: "é™ªä¼´å¤§å¸ˆåŠŸèƒ½"
    commit id: "å•æ¶ˆæ¯æ¨¡å¼"
    
    checkout development
    merge feature/happy-app
    
    branch feature/manus
    checkout feature/manus
    commit id: "è¶…çº§æ™ºèƒ½ä½“åŠŸèƒ½"
    commit id: "æ­¥éª¤å¼æ˜¾ç¤º"
    
    checkout development
    merge feature/manus
    
    commit id: "é”™è¯¯å¤„ç†å®Œå–„"
    commit id: "æ€§èƒ½ä¼˜åŒ–"
    
    checkout main
    merge development
    commit id: "v1.0.0 å‘å¸ƒ"
    
    branch hotfix/error-handling
    checkout hotfix/error-handling
    commit id: "ä¿®å¤SSEé”™è¯¯"
    
    checkout main
    merge hotfix/error-handling
    commit id: "v1.0.1 çƒ­ä¿®å¤"
```

---

## æ€»ç»“

è¿™ä¸ªAIèŠå¤©åº”ç”¨é‡‡ç”¨äº†ç°ä»£åŒ–çš„Reactæ¶æ„ï¼Œå…·æœ‰ä»¥ä¸‹æŠ€æœ¯ç‰¹ç‚¹ï¼š

### ğŸ¯ æ ¸å¿ƒæŠ€æœ¯æ ˆ
- **å‰ç«¯æ¡†æ¶**: React 18 + Hooks
- **çŠ¶æ€ç®¡ç†**: æœ¬åœ°çŠ¶æ€ (useState)
- **å®æ—¶é€šä¿¡**: Server-Sent Events (SSE)
- **æ ·å¼æ–¹æ¡ˆ**: CSS-in-JS + Tailwind CSS
- **æ„å»ºå·¥å…·**: Create React App

### ğŸš€ ä¸»è¦åŠŸèƒ½ç‰¹æ€§
- **åŒæ¨¡å¼AIæœåŠ¡**: é™ªä¼´å¤§å¸ˆ(å•æ¶ˆæ¯) + è¶…çº§æ™ºèƒ½ä½“(æ­¥éª¤å¼)
- **å®æ—¶æµå¼å¯¹è¯**: SSEæŠ€æœ¯å®ç°æ‰“å­—æœºæ•ˆæœ
- **æ™ºèƒ½é”™è¯¯å¤„ç†**: ç½‘ç»œå¼‚å¸¸ã€è§£æé”™è¯¯è‡ªåŠ¨æ¢å¤
- **å“åº”å¼è®¾è®¡**: æ”¯æŒæ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯
- **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**: åŠ è½½åŠ¨ç”»ã€çŠ¶æ€æŒ‡ç¤ºå™¨ã€æ»šåŠ¨æ§åˆ¶

### ğŸ“ˆ æ¶æ„ä¼˜åŠ¿
- **æ¨¡å—åŒ–è®¾è®¡**: ç»„ä»¶èŒè´£æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤
- **çŠ¶æ€é›†ä¸­ç®¡ç†**: é¿å…çŠ¶æ€æ··ä¹±ï¼Œä¾¿äºè°ƒè¯•
- **é”™è¯¯è¾¹ç•Œå¤„ç†**: å®Œå–„çš„å¼‚å¸¸æ•è·å’Œç”¨æˆ·æç¤º
- **æ€§èƒ½ä¼˜åŒ–**: åˆç†çš„ç»„ä»¶æ¸²æŸ“å’ŒçŠ¶æ€æ›´æ–°ç­–ç•¥

è¿™ä¸ªé¡¹ç›®å±•ç¤ºäº†å¦‚ä½•æ„å»ºä¸€ä¸ªç”Ÿäº§çº§åˆ«çš„AIèŠå¤©åº”ç”¨ï¼Œå…·æœ‰è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒå’ŒæŠ€æœ¯æ¶æ„ã€‚
